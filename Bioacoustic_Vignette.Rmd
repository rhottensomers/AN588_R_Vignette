---
title: "Bioacoustic Vignette"
author: "Reese Hotten-Somers"
date: "2023-10-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Intro to Bioacoustics:
What is bioacoustics?

Who uses it?

How it's implemented?

What it can be used for and why it is important?

## Preliminaries
Install packages: {bioacoustics}, {warbleR}, {randomForest}, {Rraven}

## Objectives


## Load in Packages
```{r, prelims}
library(warbleR)
library(bioacoustics)
library(tools)
library(randomForest)



```

# Importing Data from the internet
Warblr comes with the function query_xc which allows you to seamlessly import audio data from xeno-canto[https://xeno-canto.org/484847].
```{r, importing}
#pulling all Strepera versicolor calls without downloading locally
df1 = query_xc(qword ='Strepera versicolor type:call cnt:"Australia"', download = FALSE) #todo: include explanation for parameters of query_xc

#Filter by type   
df1 = df1[df1$Vocalization_type=="call",]
df1 = df1[df1$Quality=="A",]
df1 = df1[1:9,]
View(df1)

#Download data to working directory
query_xc(X = df1, download = TRUE, path = getwd())

```

# Importing Your Own Data
However, you can also import your own MP3
```{r, importing_mp3}

```

# Reading Your file
```{r, readf}
#Just One!
STREPV <- read_audio(file.path(getwd(), "Strepera-versicolor-571957.mp3"))
STREPV




#Read them all!!!!
read_all_mp3 <- function(){
  # List all mp3 files in current directory
  mp3_files = list.files(path=".", pattern=".mp3", all.files=TRUE, 
                         full.names=TRUE)
  audio_list <- list()
  for(files in mp3_files) {
    curr_file_path <- read_audio(file.path(files))
    audio_list <- append(audio_list, curr_file_path)
  }
  return(audio_list)
}

read_all_mp3()

#first ten seconds

# Set plot margins to 0
par(mar = c(0, 0, 0, 0), oma = c(0, 0, 0, 0))

# Display with spectro()
ticks <- c(from = 1000, to = 20000, by = 1000)

temp_slice <- c(from = 1, to = 10) # in seconds
spectro(STREPV, tlim = temp_slice, FFT_size = 512, ticks_y = ticks)
#OR 
plot(STREPV)

#mp3_to_wav


#metadata extraction
metadata(STREPV)
```

```{r, read_data}
image(fspec(STREPV, tlim = temp_slice, rotate = TRUE)) #A matrix of amplitude or decibel (dB) values in the time / frequency domain.

spectro(STREPV, tlim = temp_slice, FFT_size = 512, ticks_y = ticks)

spec_mx <- fspec(STREPV, tlim = temp_slice, FFT_size = 512, rotate = TRUE)
image(spec_mx, xaxt = "n", yaxt = "n") 


plot_zc() # used for generating a spectrgram for zero-crossing files
class(STREPV) #however it does not work for our data because the data class is wave and not zc
```

